<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dynamax Swekkie Edition</title>

<!-- PapaParse -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<!-- Markdown Renderer -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
  :root{
    --bg: #f6f8fa;
    --surface: #ffffff;
    --text: #0f1720;
    --muted: #6b7280;
    --accent: #0ea5a4;
    --card-shadow: 0 10px 30px rgba(2,6,23,0.06);
  }
  body { margin:0; font-family: Inter, system-ui, -apple-system, Arial; background:var(--bg); color:var(--text); transition: background .25s, color .25s; }
  body.dark { --bg:#071122; --surface:#07121a; --text:#e6eef6; --muted:#9fb0bf; --card-shadow:none; }

  /* Dark mode dropdown fix */
  body.dark select { color:#e6eef6 !important; background:#0b1620 !important; border:1px solid #1f2a38 !important; }
  body.dark select option { color:#e6eef6 !important; background:#0b1620 !important; }

  #modeToggle {
    position: fixed; top:12px; right:12px; padding:8px 12px;
    background:rgba(255,255,255,0.9); border-radius:10px; cursor:pointer; z-index:999;
    box-shadow:0 8px 24px rgba(2,6,23,0.06);
  }
  body.dark #modeToggle { background:rgba(0,0,0,0.5); color:#fff; box-shadow:none; }

  /* Loading screen */
  #loading {
    min-height:100vh; display:flex; flex-direction:column; gap:18px;
    align-items:center; justify-content:center; padding:20px;
  }
  #loading img.logo { width:240px; height:240px; object-fit:cover; border-radius:14px; box-shadow:var(--card-shadow); }
  #loading h1 { margin:0; font-size:22px; font-weight:700; }
  #loadBtn { padding:10px 18px; background:var(--accent); border:none; border-radius:10px; color:#fff; cursor:pointer; font-size:16px; }
  #loadingInfo { color:var(--muted); }

  /* App container */
  .wrap { max-width:1000px; margin:25px auto; padding:16px; }
  .panel { background:var(--surface); padding:16px; border-radius:12px; box-shadow:var(--card-shadow); }

  label { display:block; margin-top:12px; font-size:14px; color:var(--muted); }
  select {
    width:100%; padding:10px; margin-top:4px; border-radius:8px; border:1px solid #ccc;
    font-size:15px; background:transparent; color:inherit;
  }

  .controls { display:flex; gap:12px; margin-top:14px; }
  .controls button { padding:10px 14px; border-radius:8px; cursor:pointer; }

  #cards {
    display:grid; gap:14px; margin-top:20px;
    grid-template-columns:repeat(auto-fit, minmax(260px,1fr));
  }

  .card {
    background:var(--surface); padding:14px; border-radius:10px;
    box-shadow:var(--card-shadow); border:1px solid rgba(0,0,0,0.05);
  }
  .card h3 { margin:0 0 8px 0; font-size:15px; font-weight:700; }

  .markdown { font-size:14px; line-height:1.4; }

  img.preview { width:100%; height:160px; object-fit:cover; border-radius:8px; cursor:pointer; }

  /* Overlay */
  #overlay {
    display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75);
    z-index:9999; align-items:center; justify-content:center; padding:18px;
  }
  #overlay img { max-width:95%; max-height:95%; border-radius:10px; }
  #overlayClose {
    position:absolute; top:20px; right:20px; width:36px; height:36px;
    background:rgba(255,255,255,0.9); border-radius:50%;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; font-weight:700; font-size:20px;
  }
  body.dark #overlayClose { background:rgba(0,0,0,0.6); color:#fff; }
</style>
</head>
<body>

<div id="modeToggle">üåô</div>

<!-- Loading -->
<div id="loading">
  <img class="logo" src="https://i.imgur.com/ZUOQ974.png">
  <h1>Dynamax Swekkie Edition</h1>
  <button id="loadBtn">Load data</button>
  <div id="loadingInfo" style="display:none">Loading‚Ä¶</div>
</div>

<!-- App -->
<div id="app" class="wrap" style="display:none">
  <div class="panel">
    
    <label>Region (A)</label>
    <select id="selA"><option value="">‚Äî choose ‚Äî</option></select>

    <label>Dynamax (B)</label>
    <select id="selB"><option value="">‚Äî choose ‚Äî</option></select>

    <div class="controls">
      <button id="showBtn" style="background:var(--accent); color:#fff; border:none;">Show</button>
      <button id="resetBtn">Reset</button>
    </div>

    <div id="cards"></div>
    <div id="noResults" style="display:none; color:var(--muted); margin-top:12px;">No matching row found.</div>

  </div>
</div>

<!-- Overlay -->
<div id="overlay">
  <div id="overlayClose">‚úï</div>
  <img id="overlayImg" src="">
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRQS9tFDrOUN8aaTh6g-usN06lUbamRwAYPfhkmZLycHSmuxfiC45Gk33vQzGehprpLjTVgAi4jS2Fl/pub?output=csv";

let rows = [], headers = [], col = {};

function isImage(u){ return u && (/\.(png|jpe?g|gif|webp)$/i.test(u) || u.includes("imgur.com")); }
function unique(arr){ return [...new Set(arr.filter(x=>x && x.trim()))].sort(); }

function md(txt){ return marked.parse(String(txt || "")); }

/* Load CSV */
loadBtn.onclick = () => {
  loadBtn.disabled = true;
  loadingInfo.style.display = "block";

  Papa.parse(CSV_URL, {
    download:true,
    header:true,
    skipEmptyLines:true,
    complete: res => {
      headers = res.meta.fields;
      rows = res.data;

      // Column map (names exactly as sheet)
      col.A = headers[0]; // Region
      col.B = headers[1]; // Dynamax
      col.C = headers[2]; // Picture
      col.D = headers[3]; // Teleport
      col.E = headers[4]; // Location
      col.F = headers[5]; // Team
      col.G = headers[6]; // Strategy
      col.H = headers[7]; // Extra Notes

      const regionList = unique(rows.map(r => r[col.A]));
      fillSelect(selA, regionList);

      loading.style.display = "none";
      app.style.display = "block";
    }
  });
};

function fillSelect(sel, values){
  sel.innerHTML = `<option value="">‚Äî choose ‚Äî</option>`;
  values.forEach(v => sel.innerHTML += `<option>${v}</option>`);
}

/* Filter B based on A */
selA.onchange = () => {
  const A = selA.value;
  const filtered = rows.filter(r => r[col.A] === A);
  fillSelect(selB, unique(filtered.map(r => r[col.B])));
};

/* Show results */
showBtn.onclick = () => {
  const A = selA.value, B = selB.value;

  const row = rows.find(r =>
    r[col.A] === A &&
    (!B || r[col.B] === B)
  );

  cards.innerHTML = "";
  noResults.style.display = row ? "none" : "block";
  if(!row) return;

  // Make 6 cards C‚ÄìH
  makeCard(col.C, row[col.C], "image");
  makeCard(col.D, row[col.D], "markdown");
  makeCard(col.E, row[col.E], "markdown");
  makeCard(col.F, row[col.F], "image-full");
  makeCard(col.G, row[col.G], "markdown");
  makeCard(col.H, row[col.H], "markdown");
};

function makeCard(name, value, type){
  const card = document.createElement("div");
  card.className = "card";

  const title = document.createElement("h3");
  title.textContent = name;
  card.appendChild(title);

  const body = document.createElement("div");

  if(type === "image" && isImage(value)){
    const img = document.createElement("img");
    img.className = "preview";
    img.src = value;
    body.appendChild(img);
  }
  else if(type === "image-full" && isImage(value)){
    const img = document.createElement("img");
    img.className = "preview";
    img.src = value;
    img.onclick = ()=> openOverlay(value);
    body.appendChild(img);
  }
  else if(type === "markdown"){
    const div = document.createElement("div");
    div.className = "markdown";
    div.innerHTML = md(value);
    body.appendChild(div);
  }
  else {
    const p = document.createElement("div");
    p.textContent = value || "(empty)";
    body.appendChild(p);
  }

  card.appendChild(body);
  cards.appendChild(card);
}

/* Overlay */
function openOverlay(src){
  overlayImg.src = src;
  overlay.style.display = "flex";
}
overlayClose.onclick = () => overlay.style.display = "none";
overlay.onclick = e => { if(e.target === overlay) overlay.style.display="none"; };
document.addEventListener("keydown", e => { if(e.key==="Escape") overlay.style.display="none"; });

/* Reset */
resetBtn.onclick = () => {
  selA.selectedIndex = 0;
  selB.innerHTML = `<option value="">‚Äî choose ‚Äî</option>`;
  cards.innerHTML = "";
  noResults.style.display = "none";
};

/* Dark mode */
modeToggle.onclick = () => {
  document.body.classList.toggle("dark");
  modeToggle.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
};
</script>
</body>
</html>
