<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dynamax Swekkie Edition</title>

<!-- PapaParse -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<!-- Markdown Parser -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
  :root{
    --bg: #f6f8fa;
    --surface: #ffffff;
    --text: #0f1720;
    --muted: #6b7280;
    --accent: #0ea5a4;
    --card-shadow: 0 10px 30px rgba(2,6,23,0.06);
  }
  body { margin:0; font-family: Inter, system-ui, -apple-system, Arial; background:var(--bg); color:var(--text); transition: background .25s, color .25s; }
  body.dark { --bg: #071122; --surface: #07121a; --text: #e6eef6; --muted: #9fb0bf; --card-shadow:none; }

  body.dark select option {
    color: #e6eef6 !important;
    background: #0b1620 !important;
}

  #modeToggle {
    position: fixed; top: 12px; right: 12px;
    background: rgba(255,255,255,0.9);
    padding:8px 12px; border-radius:10px;
    cursor:pointer; user-select:none; z-index:999;
    box-shadow:0 8px 24px rgba(2,6,23,0.06);
  }
  body.dark #modeToggle { background:rgba(0,0,0,0.5); color:#fff; box-shadow:none; }

  /* Loading */
  #loading {
    min-height:100vh;
    display:flex; flex-direction:column; gap:18px;
    align-items:center; justify-content:center; text-align:center;
    padding:20px;
  }
  #loading img.logo {
    width:240px; height:240px; object-fit:cover;
    border-radius:14px; box-shadow:var(--card-shadow);
  }
  #loading h1 { margin:0; font-size:22px; font-weight:700; }
  #loadBtn {
    padding:10px 18px; background:var(--accent); border:none;
    border-radius:10px; color:#fff; cursor:pointer; font-size:16px; width:auto;
  }
  #loadingInfo { color:var(--muted); }

  /* App */
  .wrap { max-width:1000px; margin:25px auto; padding:16px; }
  .panel { background:var(--surface); padding:16px; border-radius:12px; box-shadow:var(--card-shadow); }

  label { display:block; margin-top:12px; font-size:14px; color:var(--muted); }
  select {
    width:100%; padding:10px; border-radius:8px; border:1px solid #ccc;
    margin-top:4px; font-size:15px; background:transparent; color:inherit;
  }

  .controls { display:flex; gap:12px; margin-top:14px; }
  .controls button { padding:10px 14px; border-radius:8px; cursor:pointer; }

  #cards {
    margin-top:20px;
    display:grid; gap:14px;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  }

  .card {
    background:var(--surface); padding:14px; border-radius:10px; box-shadow:var(--card-shadow); border:1px solid rgba(0,0,0,0.05);
  }
  .card h3 { margin:0 0 8px 0; font-size:15px; font-weight:700; }

  img.preview { width:100%; height:160px; object-fit:cover; border-radius:8px; }

  .markdown { font-size:14px; line-height:1.4; }

  /* Fullscreen overlay */
  #overlay {
    display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75);
    z-index:9999; align-items:center; justify-content:center; padding:18px;
  }
  #overlay img {
    max-width:95%; max-height:95%; border-radius:10px;
    box-shadow:0 12px 40px rgba(0,0,0,0.7);
  }
  #overlayClose {
    position:absolute; top:18px; right:18px;
    background:rgba(255,255,255,0.9);
    width:36px; height:36px; border-radius:50%; cursor:pointer;
    display:flex; align-items:center; justify-content:center;
    font-weight:700;
  }
  body.dark #overlayClose { background:rgba(0,0,0,0.5); color:#fff; }

</style>
</head>
<body>

<div id="modeToggle">üåô</div>

<!-- Loading screen -->
<div id="loading">
  <img class="logo" src="https://i.imgur.com/ZUOQ974.png">
  <h1>Dynamax Swekkie Edition</h1>
  <button id="loadBtn">Load data</button>
  <div id="loadingInfo" style="display:none">Loading‚Ä¶</div>
</div>

<!-- Main App -->
<div id="app" class="wrap" style="display:none">
  <div class="panel">

    <label for="selA">Choose Region (A)</label>
    <select id="selA"><option value="">‚Äî choose ‚Äî</option></select>

    <label for="selB">Choose Location (B)</label>
    <select id="selB"><option value="">‚Äî choose ‚Äî</option></select>

    <label for="selC">Choose Dynamax (C)</label>
    <select id="selC"><option value="">‚Äî choose ‚Äî</option></select>

    <div class="controls">
      <button id="showBtn" style="background:var(--accent); color:#fff; border:none;">Show</button>
      <button id="resetBtn">Reset</button>
    </div>

    <div id="cards"></div>
    <div id="noResults" style="color:var(--muted); display:none; margin-top:10px;">No matching row found.</div>
  </div>
</div>

<!-- Image overlay -->
<div id="overlay">
  <div id="overlayClose">‚úï</div>
  <img id="overlayImg" src="">
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRQS9tFDrOUN8aaTh6g-usN06lUbamRwAYPfhkmZLycHSmuxfiC45Gk33vQzGehprpLjTVgAi4jS2Fl/pub?output=csv";

let rows = [], headers = [], col = {};

/* --- Utilities --- */
function isImageUrl(u){ return u && (/\.(png|jpe?g|gif|webp)$/i.test(u) || u.includes("imgur.com")); }
function unique(arr){ return [...new Set(arr.filter(x=>x && x.trim()))].sort(); }
function md(text){ return marked.parse(String(text||"")); }

/* --- Load CSV --- */
document.getElementById("loadBtn").onclick = () => {
  loadBtn.disabled = true;
  loadingInfo.style.display = "block";

  Papa.parse(CSV_URL, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: res => {
      headers = res.meta.fields;
      rows = res.data;

      col.A = headers[0]; col.B = headers[1]; col.C = headers[2];
      col.D = headers[3]; col.E = headers[4]; col.F = headers[5];
      col.G = headers[6]; col.H = headers[7];

      const regions = unique(rows.map(r => r[col.A]));
      fillSelect(selA, regions, "‚Äî choose ‚Äî");

      loading.style.display = "none";
      app.style.display = "block";
    }
  });
};

function fillSelect(sel, arr, placeholder){
  sel.innerHTML = `<option value="">${placeholder}</option>`;
  arr.forEach(v => sel.innerHTML += `<option>${v}</option>`);
}

selA.onchange = () => {
  const A = selA.value;
  const filtered = rows.filter(r => r[col.A] === A);
  fillSelect(selB, unique(filtered.map(r=>r[col.B])), "‚Äî choose ‚Äî");
  selC.innerHTML = `<option value="">‚Äî choose ‚Äî</option>`;
};

selB.onchange = () => {
  const A = selA.value, B = selB.value;
  const filtered = rows.filter(r => r[col.A] === A && r[col.B] === B);
  fillSelect(selC, unique(filtered.map(r=>r[col.C])), "‚Äî choose ‚Äî");
};

/* --- Show results (one row ‚Üí five cards) --- */
showBtn.onclick = () => {
  const A = selA.value, B = selB.value, C = selC.value;
  const match = rows.find(r =>
    r[col.A] === A &&
    (!B || r[col.B] === B) &&
    (!C || r[col.C] === C)
  );

  cards.innerHTML = "";
  noResults.style.display = match ? "none" : "block";
  if(!match) return;

  makeCard(col.D, match[col.D], "image-preview");
  makeCard(col.E, match[col.E], "markdown");
  makeCard(col.F, match[col.F], "image-full");
  makeCard(col.G, match[col.G], "markdown");
  makeCard(col.H, match[col.H], "markdown");
};

function makeCard(title, value, type){
  const card = document.createElement("div");
  card.className = "card";

  const h = document.createElement("h3");
  h.textContent = title;
  card.appendChild(h);

  const body = document.createElement("div");

  if(type === "image-preview" && isImageUrl(value)){
    const img = document.createElement("img");
    img.className = "preview";
    img.src = value;
    body.appendChild(img);
  }
  else if(type === "image-full" && isImageUrl(value)){
    const img = document.createElement("img");
    img.className = "preview";
    img.src = value;
    img.style.cursor = "pointer";
    img.onclick = ()=> openOverlay(value);
    body.appendChild(img);
  }
  else if(type === "markdown"){
    const div = document.createElement("div");
    div.className = "markdown";
    div.innerHTML = md(value || "");
    body.appendChild(div);
  }
  else {
    const p = document.createElement("div");
    p.textContent = value || "(empty)";
    body.appendChild(p);
  }

  card.appendChild(body);
  cards.appendChild(card);
}

/* --- Overlay --- */
function openOverlay(src){
  overlayImg.src = src;
  overlay.style.display = "flex";
}
overlayClose.onclick = () => overlay.style.display = "none";
overlay.onclick = e => { if(e.target === overlay) overlay.style.display="none"; };
document.addEventListener("keydown", e => { if(e.key==="Escape") overlay.style.display="none"; });

/* --- Reset --- */
resetBtn.onclick = () => {
  selA.selectedIndex = 0;
  selB.innerHTML = `<option value="">‚Äî choose ‚Äî</option>`;
  selC.innerHTML = `<option value="">‚Äî choose ‚Äî</option>`;
  cards.innerHTML = "";
  noResults.style.display = "none";
};

/* --- Dark mode --- */
modeToggle.onclick = () => {
  document.body.classList.toggle("dark");
  modeToggle.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
};
</script>

</body>
</html>
